<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Identificación</title>
  <link rel="stylesheet" href="identificacion.css" />
  <link href="https://fonts.googleapis.com/css2?family=Dongle:wght@700&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- Fondo animado -->
  <canvas class="background-binary"></canvas>

  <!-- Login principal -->
  <div class="login-wrapper">
    <h1 class="login-title">Refinador</h1>

    <div class="login-container">
      <label for="username-input" class="sr-only">Nombre</label>
      <input type="text" id="username-input" placeholder="Tu nombre (opcional)" />

      <label for="email-input" class="sr-only">Correo electrónico</label>
      <input type="email" id="email-input" placeholder="Correo electrónico" />
      <span class="error-message" id="email-error"></span>

      <button id="login-button">Entrar</button>

      <div class="divider">o</div>

      <button id="guest-button" class="guest">Entrar como invitado</button>
    </div>
  </div>

  <!-- Modal de selección de avatar -->
  <div class="avatar-modal hidden" id="avatarModal">
    <div class="avatar-modal-content">
      
      <!-- Botón de cierre -->
      <button class="avatar-close" id="avatarCloseBtn" aria-label="Cerrar">
        <i data-lucide="x"></i>
      </button>

      <!-- Título -->
      <h2>Elige un avatar</h2>

      <!-- Avatares -->
      <div class="avatar-grid">
        <i data-lucide="cookie" class="avatar" data-avatar="cookie"></i>
        <i data-lucide="handshake" class="avatar" data-avatar="handshake"></i>
        <i data-lucide="chef-hat" class="avatar" data-avatar="chef-hat"></i>
        <i data-lucide="club" class="avatar" data-avatar="club"></i>
        <i data-lucide="diamond" class="avatar" data-avatar="diamond"></i>
        <i data-lucide="heart" class="avatar" data-avatar="heart"></i>
        <i data-lucide="spade" class="avatar" data-avatar="spade"></i>
        <i data-lucide="bird" class="avatar" data-avatar="bird"></i>
        <i data-lucide="rabbit" class="avatar" data-avatar="rabbit"></i>
        <i data-lucide="turtle" class="avatar" data-avatar="turtle"></i>
      </div>

      <!-- Mensaje de error para validación -->
      <span class="error-message" id="avatar-error"></span>

      <!-- Botón para continuar -->
      <div class="avatar-footer">
        <button id="confirmAvatarBtn" class="confirm-button">
          <i data-lucide="arrow-right"></i>
        </button>
      </div>
    </div>
  </div>

  <script src="identificacion.js"></script>
  <script>
    // Renderizar íconos Lucide
    lucide.createIcons();

    // Redirigir si ya hay sesión activa
    if (localStorage.getItem('session')) {
      window.location.replace('index.html');
    }

    // Invitado
    document.getElementById('guest-button').addEventListener('click', () => {
      localStorage.setItem('session', 'true');
      localStorage.setItem('username', 'Invitado');
      localStorage.setItem('avatar', 'cookie'); // avatar por defecto
      window.location.replace('index.html');
    });

    // Login con email
    document.getElementById('login-button').addEventListener('click', () => {
      const email = document.getElementById('email-input').value;
      const username = document.getElementById('username-input').value || 'Usuario';
      if (!email || !email.includes('@')) {
        document.getElementById('email-error').textContent = 'Introduce un correo válido';
        return;
      }

      // Guardar datos básicos, mostrar modal
      localStorage.setItem('session', 'true');
      localStorage.setItem('email', email);
      localStorage.setItem('username', username);
      document.getElementById('email-error').textContent = '';
      document.getElementById('avatarModal').classList.remove('hidden');
    });

    // Confirmar avatar
    document.getElementById('confirmAvatarBtn').addEventListener('click', () => {
      const selected = document.querySelector('.avatar.selected');
      if (!selected) {
        document.getElementById('avatar-error').textContent = 'Selecciona un avatar para continuar';
        return;
      }
      localStorage.setItem('avatar', selected.dataset.avatar);
      window.location.replace('index.html');
    });

    // Seleccionar visualmente el avatar
    document.querySelectorAll('.avatar').forEach(avatar => {
      avatar.addEventListener('click', () => {
        document.querySelectorAll('.avatar').forEach(a => a.classList.remove('selected'));
        avatar.classList.add('selected');
      });
    });

    // Cerrar modal
    document.getElementById('avatarCloseBtn').addEventListener('click', () => {
      document.getElementById('avatarModal').classList.add('hidden');
    });
  </script>
</body>
</html>
